\usepackage{geometry} % package for adjustment of margin
\usepackage{color} % package for coloring
\usepackage{hyperref, pxjahyper} % package for making hyperlink
\usepackage{cite} % package for getting reference together, display [1-3]
\usepackage{graphicx} % package for inserting graphs or figures, such as "\includegraphics"
\usepackage{here} % package for forcing graphs or figures here
\usepackage{comment} % package for multiline comment
\usepackage{amsmath, mathtools, amsthm} % package for math environment, such as "equation", "align", "cases", "proof".
\usepackage{amssymb} % package for math symbols, such as "text", "iint"
\usepackage{physics} % package for making some command easier, such as "\qty", "\dd", "\pdv", "\vb", "\mqty", "\braket"
\usepackage{siunitx} % package for SI unit
\usepackage{colonequals} % package for colon
\usepackage{ifthen} % package for conditional branch
\usepackage{bm, bbm} % package for bold style
\usepackage{wrapfig} % package for figure of the text wrapping around
\usepackage{xparse} % package for difinition of new command
\usepackage[version=4]{mhchem} % package for chemistry such as atomic number
\usepackage[hang, small, bf]{caption} % package for caption
\usepackage[subrefformat=parens]{subcaption} % package for subcaption

\geometry{left=20truemm, right=20truemm, top=20truemm, bottom=20truemm}
\mathtoolsset{showonlyrefs=true} % numbering only referred equation
% \allowdisplaybreaks[4] % go new page in align environment
\theoremstyle{definition} % in theorem, only headline is bold style
\captionsetup{compatibility=false} % stabilize the behavior of the 'caption' package
% \includecomment{comment} % to decide whether showing comments



\makeatletter

% for skip and space

\newcommand{\skipend}{\vskip.2\baselineskip}
\newcommand{\skippr}{\vspace{1.0em}}

% labelled sections

\ifthenelse{\isundefined{\chapter}}{}{
  \newcommand{\lchapter}{\@ifstar{\schapter}{\achapter}}
    \newcommand{\achapter}[1]{\chapter{#1} \label{chap:#1} \skipend}
    \newcommand{\schapter}[1]{\chapter*{#1} \label{chap:#1} \skipend}
  \newcommand{\lchapterf}{\@ifstar{\schapter}{\achapter}}
    \newcommand{\achapterf}[2]{\chapter{#1} \label{chap:#2} \skipend}
    \newcommand{\schapterf}[2]{\chapter*{#1} \label{chap:#2} \skipend}
}
\newcommand{\lsection}{\@ifstar{\ssection}{\asection}}
  \newcommand{\asection}[1]{\section{#1} \label{sec:#1} \skipend}
  \newcommand{\ssection}[1]{\section*{#1} \label{sec:#1} \skipend}
\newcommand{\lsectionf}{\@ifstar{\ssectionf}{\asectionf}}
  \newcommand{\asectionf}[2]{\section{#1} \label{sec:#2} \skipend}
  \newcommand{\ssectionf}[2]{\section*{#1} \label{sec:#2} \skipend}
\newcommand{\lsubsection}{\@ifstar{\ssubsection}{\asubsection}}
  \newcommand{\asubsection}[1]{\subsection{#1} \label{subsec:#1} \skipend}
  \newcommand{\ssubsection}[1]{\subsection*{#1} \label{subsec:#1} \skipend}
\newcommand{\lsubsectionf}{\@ifstar{\ssubsectionf}{\asubsectionf}}
  \newcommand{\asubsectionf}[2]{\subsection{#1} \label{subsec:#2} \skipend}
  \newcommand{\ssubsectionf}[2]{\subsection*{#1} \label{subsec:#2} \skipend}

% new environments

\newcommand{\eq}{\@ifstar{\seq}{\aeq}}
  \newcommand{\aeq}[2]{\begin{equation} \label{eq:#1} #2 \end{equation}}
  \newcommand{\seq}[1]{\begin{equation*} #1 \end{equation*}}
\newcommand{\eqg}{\@ifstar{\seqg}{\aeqg}}
  \newcommand{\aeqg}[2]{\begin{gather} #2 \label{eq:#1} \end{gather}}
  \newcommand{\seqg}[1]{\begin{gather} #1 \end{gather}}
\newcommand{\eqa}{\@ifstar{\seqa}{\aeqa}}
  \newcommand{\aeqa}[2]{\begin{align} #2 \label{eq:#1} \end{align}}
  \newcommand{\seqa}[1]{\begin{align} #1 \end{align}}
\newcommand{\eqf}{\@ifstar{\seqf}{\aeqf}}
  \newcommand{\aeqf}[2]{\footnotesize \begin{align} #2 \label{eq:#1} \end{align} \normalsize}
  \newcommand{\seqf}[2]{\footnotesize \begin{align} #1 \end{align} \normalsize}

\newcommand{\theoremtmp}[1]{\vskip.5\baselineskip \begin{flushleft} \begin{minipage}{\textwidth} \parindent=1zw #1 \end{minipage} \end{flushleft}}

\newtheorem{axiom}{\textit{Ax.}}[subsection]
\newcommand{\axi}[2]{\theoremtmp{\begin{axiom} \textbf{#1} \par #2 \label{ax:#1} \end{axiom}} \skipend}
  \newcommand{\axif}[3]{\begin{axiom} \textbf{#1} \par #3 \label{ax:#2} \end{axiom} \skipend}
\newtheorem{definition}{\textit{Def.}}[subsection]
\newcommand{\dfn}[2]{\theoremtmp{\begin{definition} \textbf{#1} \par #2 \label{def:#1} \end{definition}} \skipend}
  \newcommand{\dfnf}[3]{\theoremtmp{\begin{definition} \textbf{#1} \par #3 \label{def:#2} \end{definition}} \skipend}
\newtheorem{theorem}{\textit{Thm.}}[subsection]
\newcommand{\thm}{\@ifstar{\sthm}{\athm}}
  \newcommand{\sthm}[2]{\theoremtmp{\begin{theorem} \, \par #1 \label{thm:\thetheorem} \end{theorem}} \begin{proof} \, \par #2 \end{proof} \skippr}
  \newcommand{\athm}[3]{\theoremtmp{\begin{theorem} \textbf{#1} \par #2 \label{thm:#1} \end{theorem}} \begin{proof} \, \par #3 \end{proof} \skippr}
  \newcommand{\thmf}[4]{\theoremtmp{\begin{theorem} \textbf{#1} \par #3 \label{thm:#2} \end{theorem}} \begin{proof} \, \par #4 \end{proof} \skippr}
\newtheorem{corollary}[theorem]{\textit{Cor.}}
\newcommand{\cor}{\@ifstar{\scor}{\acor}}
  \newcommand{\scor}[1]{\theoremtmp{\begin{corollary} \, \par #1 \label{cor:\thetheorem} \end{corollary}} \skipend}
  \newcommand{\acor}[2]{\theoremtmp{\begin{corollary} \textbf{#1} \par #2 \label{cor:#1} \end{corollary}} \skipend}
  \newcommand{\corf}[3]{\theoremtmp{\begin{corollary} \textbf{#1} \par #3 \label{cor:#2} \end{corollary}} \skipend}
\newtheorem{lemma}[theorem]{\textit{Lem.}}
\newcommand{\lem}{\@ifstar{\slem}{\alem}}
  \newcommand{\slem}[2]{\theoremtmp{\begin{lemma} \, \par #1 \label{lem:\thetheorem} \end{lemma}} \begin{proof} \, \par #2 \end{proof} \skippr}
  \newcommand{\alem}[3]{\theoremtmp{\begin{lemma} \textbf{#1} \par #2 \label{lem:#1} \end{lemma}} \begin{proof} \, \par #3 \end{proof} \skippr}
  \newcommand{\lemf}[4]{\theoremtmp{\begin{lemma} \textbf{#1} \par #3 \label{lem:#2} \end{lemma}} \begin{proof} \, \par #4 \end{proof} \skippr}
\newtheorem{remark}{\textit{Rem.}}[subsection]
\newcommand{\rem}[2]{\theoremtmp{\begin{remark} \textbf{#1} \par #2 \label{rem:#1} \end{remark}} \skipend}
  \newcommand{\remf}[3]{\theoremtmp{\begin{remark} \textbf{#1} \par #3 \label{rem:#2} \end{remark}} \skipend}
% \renewcommand{\proofname}{\textit{Proof.}}

% math or some symbols

\newcommand{\C}{\mathbb{C}}
\newcommand{\N}{\mathbb{N}}
\renewcommand{\P}{\mathfrak{P}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\renewcommand{\S}{\mathfrak{S}}
\newcommand{\Z}{\mathbb{Z}}

\newcommand{\const}{\mathrm{const.}}
\newcommand{\defiff}{\ratio \leftrightarrow}
\newcommand{\eins}{\mathbbm{1}}
\newcommand{\etal}{\textit{et al.}}
\newcommand{\hc}{\mathrm{h. c.}}
\newcommand{\otherwise}{\text{otherwise}}
\renewcommand{\qedsymbol}{$\blacksquare$}
\newcommand{\sand}{\, \land \,}
\newcommand{\siff}{\, \Leftrightarrow \,}
\newcommand{\sor}{\, \lor \,}
\newcommand{\sto}{\, \Rightarrow \,}
\newcommand{\zeros}{\mathbb{O}}

% math operator

\renewcommand{\bar}[1]{\overline{#1}}
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\id}[1]{\mathrm{id}_{#1}}
\newcommand{\lpartial}[1]{\overleftarrow{\partial_{#1}}}
\newcommand{\lrpartial}[1]{\overleftrightarrow{\partial_{#1}}}
\newcommand{\rot}[1]{\curl{#1}}
\newcommand{\sqty}[1]{\left] #1 \right[}
\renewcommand{\tilde}[1]{\widetilde{#1}}
\newcommand{\tp}[1]{\,^t\!#1}

\DeclareDocumentCommand\P{}{\trigbraces{\mathfrak{P}}}
\DeclareDocumentCommand\diag{}{\opbraces{\operatorname{diag}}}
\DeclareDocumentCommand\dom{}{\trigbraces{\operatorname{dom}}}
\DeclareDocumentCommand\erf{}{\trigbraces{\operatorname{erf}}}
\DeclareDocumentCommand\exp{}{\trigbraces{\exponential}}
\DeclareDocumentCommand\inf{}{\opbraces{\operatorname{inf}}}
\DeclareDocumentCommand\max{}{\opbraces{\operatorname{max}}}
\DeclareDocumentCommand\min{}{\opbraces{\operatorname{min}}}
\DeclareDocumentCommand\ord{}{\trigbraces{\operatorname{ord}}}
\DeclareDocumentCommand\ran{}{\trigbraces{\operatorname{ran}}}
\DeclareDocumentCommand\sign{}{\trigbraces{\operatorname{sgn}}}
\DeclareDocumentCommand\sinc{}{\trigbraces{\operatorname{sinc}}}
\DeclareDocumentCommand\sup{}{\opbraces{\operatorname{sup}}}
\DeclareDocumentCommand\tr{}{\trigbraces{\trace}}
\DeclareDocumentCommand\Aut{}{\trigbraces{\operatorname{Aut}}}
\DeclareDocumentCommand\End{}{\trigbraces{\operatorname{End}}}
\DeclareDocumentCommand\Fix{}{\trigbraces{\operatorname{Fix}}}
\DeclareDocumentCommand\GL{}{\trigbraces{\operatorname{GL}}}
\DeclareDocumentCommand\Hom{}{\trigbraces{\operatorname{Hom}}}
\DeclareDocumentCommand\Im{}{\trigbraces{\operatorname{Im}}}
\DeclareDocumentCommand\Ker{}{\trigbraces{\operatorname{Ker}}}
\DeclareDocumentCommand\Map{}{\trigbraces{\operatorname{Map}}}
\DeclareDocumentCommand\Re{}{\trigbraces{\operatorname{Re}}}
\DeclareDocumentCommand\Span{}{\trigbraces{\operatorname{Span}}}
\DeclareDocumentCommand\Stab{}{\trigbraces{\operatorname{Stab}}}

% for caption

\newcommand{\captf}{\@ifstar{\scaptf}{\acaptf}}
  \newcommand{\acaptf}[2]{\makeatletter\def\@captype{figure}\makeatother\caption{#1}\small\vspace{-15pt}\center{#2}\normalsize}
  \newcommand{\scaptf}[1]{\makeatletter\def\@captype{figure}\makeatother\caption{#1}}
\newcommand{\captt}{\@ifstar{\scaptt}{\acaptt}}
  \newcommand{\acaptt}[2]{\makeatletter\def\@captype{table}\makeatother\caption{#1}\small\vspace{-15pt}\center{#2}\normalsize}
  \newcommand{\scaptt}[1]{\makeatletter\def\@captype{table}\makeatother\caption{#1}}

% for references

\ifthenelse{\isundefined{\chapter}}{}{
  \newcommand{\chapref}[1]{第\ref{chap:#1}章}
}
\newcommand{\secref}[1]{節~\ref{sec:#1}}
\newcommand{\subsecref}[1]{小節~\ref{subsec:#1}}

\newcommand{\eqnref}{\@ifstar{\seqnref}{\aeqnref}}
  \newcommand{\seqnref}[1]{\eqref{eq:#1}}
  \newcommand{\aeqnref}[1]{式~\eqref{eq:#1}}
\newcommand{\figref}{\@ifstar{\sfigref}{\afigref}}
  \newcommand{\sfigref}[1]{図~\ref{fig:#1}}
  \newcommand{\afigref}[1]{（図~\ref{fig:#1}）}
\newcommand{\tabref}{\@ifstar{\stabref}{\atabref}}
  \newcommand{\stabref}[1]{表~\ref{tab:#1}}
  \newcommand{\atabref}[1]{（表~\ref{tab:#1}）}

\newcommand{\axiref}[1]{公理~\ref{ax:#1}}
\newcommand{\dfnref}[1]{定義~\ref{def:#1}}
\newcommand{\thmref}[1]{定理~\ref{thm:#1}}
\newcommand{\corref}[1]{系~\ref{cor:#1}}
\newcommand{\lemref}[1]{補題~\ref{lem:#1}}

\newcounter{tmp}
\newcommand{\mthmref}[1]{\setcounter{tmp}{\value{theorem}}\addtocounter{tmp}{#1}\thmref{\thesubsection.\thetmp}}
\newcommand{\mlemref}[1]{\setcounter{tmp}{\value{theorem}}\addtocounter{tmp}{#1}\lemref{\thesubsection.\thetmp}}

\newcommand{\refer}[6]{\bibitem{#2} #1, \textit{#2}. #3 \textbf{#4}, #5 (#6).} % arguments means 'author', 'title', 'publisher', 'volume', 'page', 'year'
\newcommand{\referf}[7]{\bibitem{#7} #1, \textit{#2}. #3 \textbf{#4}, #5 (#6).} % arguments means 'author', 'title', 'publisher', 'volume', 'page', 'year', 'label'
\newcommand{\referbook}[4]{\bibitem{#2} #1, \textit{#2}. #3 (#4).} % arguments means 'author', 'title', 'publisher', 'year'
\newcommand{\referthesis}[5]{\bibitem{#2} #1, \textit{#2}. #3, #4 (#5).} % arguments means 'author', 'title', 'type', 'publisher', 'year'

% for appendix
\renewcommand{\appendix}{
  \chapter*{付録}
  \addcontentsline{toc}{chapter}{付録}

  \setcounter{section}{0}
  \renewcommand{\thesection}{\Alph{section}}
  \setcounter{equation}{0}
  \renewcommand{\theequation}{\Alph{section}.\arabic{equation}}
  \setcounter{figure}{0}
  \renewcommand{\thefigure}{\Alph{section}.\arabic{figure}}
  \setcounter{table}{0}
  \renewcommand{\thetable}{\Alph{section}.\arabic{table}}
}

\makeatother
